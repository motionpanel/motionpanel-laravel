import{j as t,r as f,b as y,H as $,c as Ie,J as K}from"./app-BZVehHhf.js";import{B as Se,a as S,R as Y,T as Q,b as M,S as V,i as W,u as Te,P as T,c as N,j as X,f as Fe,g as Ee,C as H,l as Pe,m as q,n as _e,o as U,p as Ae,E as Me,q as De,r as ke}from"./circle-spinning-BDIvvxFO.js";import{c as E,g as Oe,P as Z,h as $e,f as L}from"./page-header-BAaekGCx.js";function Le(e){const{failedJob:o,onDelete:n,onRetry:s,showFailedAt:l,showRetryButton:i,showDeleteButton:r,description:a,className:u,onItemClick:c}=e;return t.jsx("div",{className:E("rounded","dark:border","dark:border-slate-800","hover:bg-zinc-100","transition-colors","p-4","cursor-pointer",u),onClick:()=>c&&c(o),children:t.jsxs("div",{className:"flex",children:[t.jsxs("div",{className:"flex-col flex-1",children:[t.jsx(Se,{className:"font-semibold mb-2",children:o.queue}),t.jsx("div",{className:"flex",children:t.jsxs("div",{className:"font-semibold",children:["ID: ",o.id]})}),t.jsxs("div",{className:"flex-col",children:[l&&t.jsxs("div",{className:"text-gray-500",children:["Failed ",Oe(o.failed_at)]}),a&&t.jsx("em",{className:"dark:text-slate-500",children:a})]})]}),t.jsxs("div",{className:"flex space-x-2",children:[i&&t.jsx(S,{size:"icon",variant:"ghost",className:"text-indigo-800",onClick:x=>{x.stopPropagation(),s&&s(o)},children:t.jsx(Y,{className:"w-4 h-4"})}),r&&t.jsx(S,{size:"icon",variant:"ghost",className:"text-red-800",onClick:x=>{x.stopPropagation(),n&&n(o)},children:t.jsx(Q,{className:"w-4 h-4"})})]})]})})}function Be(e,o=[]){let n=[];function s(i,r){const a=f.createContext(r),u=n.length;n=[...n,r];function c(m){const{scope:p,children:v,...d}=m,h=(p==null?void 0:p[e][u])||a,j=f.useMemo(()=>d,Object.values(d));return t.jsx(h.Provider,{value:j,children:v})}function x(m,p){const v=(p==null?void 0:p[e][u])||a,d=f.useContext(v);if(d)return d;if(r!==void 0)return r;throw new Error(`\`${m}\` must be used within \`${i}\``)}return c.displayName=i+"Provider",[c,x]}const l=()=>{const i=n.map(r=>f.createContext(r));return function(a){const u=(a==null?void 0:a[e])||i;return f.useMemo(()=>({[`__scope${e}`]:{...a,[e]:u}}),[a,u])}};return l.scopeName=e,[s,Ge(l,...o)]}function Ge(...e){const o=e[0];if(e.length===1)return o;const n=()=>{const s=e.map(l=>({useScope:l(),scopeName:l.scopeName}));return function(i){const r=s.reduce((a,{useScope:u,scopeName:c})=>{const m=u(i)[`__scope${c}`];return{...a,...m}},{});return f.useMemo(()=>({[`__scope${o.scopeName}`]:r}),[r])}};return n.scopeName=o.scopeName,n}function Je(e){const o=e+"CollectionProvider",[n,s]=Be(o),[l,i]=n(o,{collectionRef:{current:null},itemMap:new Map}),r=v=>{const{scope:d,children:h}=v,j=y.useRef(null),b=y.useRef(new Map).current;return t.jsx(l,{scope:d,itemMap:b,collectionRef:j,children:h})};r.displayName=o;const a=e+"CollectionSlot",u=y.forwardRef((v,d)=>{const{scope:h,children:j}=v,b=i(a,h),g=M(d,b.collectionRef);return t.jsx(V,{ref:g,children:j})});u.displayName=a;const c=e+"CollectionItemSlot",x="data-radix-collection-item",m=y.forwardRef((v,d)=>{const{scope:h,children:j,...b}=v,g=y.useRef(null),R=M(d,g),I=i(c,h);return y.useEffect(()=>(I.itemMap.set(g,{ref:g,...b}),()=>void I.itemMap.delete(g))),t.jsx(V,{[x]:"",ref:R,children:j})});m.displayName=c;function p(v){const d=i(e+"CollectionConsumer",v);return y.useCallback(()=>{const j=d.collectionRef.current;if(!j)return[];const b=Array.from(j.querySelectorAll(`[${x}]`));return Array.from(d.itemMap.values()).sort((I,F)=>b.indexOf(I.ref.current)-b.indexOf(F.ref.current))},[d.collectionRef,d.itemMap])}return[{Provider:r,Slot:u,ItemSlot:m},p,s]}function ze(e,o=[]){let n=[];function s(i,r){const a=f.createContext(r),u=n.length;n=[...n,r];function c(m){const{scope:p,children:v,...d}=m,h=(p==null?void 0:p[e][u])||a,j=f.useMemo(()=>d,Object.values(d));return t.jsx(h.Provider,{value:j,children:v})}function x(m,p){const v=(p==null?void 0:p[e][u])||a,d=f.useContext(v);if(d)return d;if(r!==void 0)return r;throw new Error(`\`${m}\` must be used within \`${i}\``)}return c.displayName=i+"Provider",[c,x]}const l=()=>{const i=n.map(r=>f.createContext(r));return function(a){const u=(a==null?void 0:a[e])||i;return f.useMemo(()=>({[`__scope${e}`]:{...a,[e]:u}}),[a,u])}};return l.scopeName=e,[s,Ke(l,...o)]}function Ke(...e){const o=e[0];if(e.length===1)return o;const n=()=>{const s=e.map(l=>({useScope:l(),scopeName:l.scopeName}));return function(i){const r=s.reduce((a,{useScope:u,scopeName:c})=>{const m=u(i)[`__scope${c}`];return{...a,...m}},{});return f.useMemo(()=>({[`__scope${o.scopeName}`]:r}),[r])}};return n.scopeName=o.scopeName,n}var Ve=f.createContext(void 0);function ee(e){const o=f.useContext(Ve);return e||o||"ltr"}var A="rovingFocusGroup.onEntryFocus",He={bubbles:!1,cancelable:!0},P="RovingFocusGroup",[D,te,qe]=Je(P),[Ue,oe]=ze(P,[qe]),[Ye,Qe]=Ue(P),ne=f.forwardRef((e,o)=>t.jsx(D.Provider,{scope:e.__scopeRovingFocusGroup,children:t.jsx(D.Slot,{scope:e.__scopeRovingFocusGroup,children:t.jsx(We,{...e,ref:o})})}));ne.displayName=P;var We=f.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:n,orientation:s,loop:l=!1,dir:i,currentTabStopId:r,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:u,onEntryFocus:c,preventScrollOnEntryFocus:x=!1,...m}=e,p=f.useRef(null),v=M(o,p),d=ee(i),[h=null,j]=W({prop:r,defaultProp:a,onChange:u}),[b,g]=f.useState(!1),R=Te(c),I=te(n),F=f.useRef(!1),[Ce,J]=f.useState(0);return f.useEffect(()=>{const C=p.current;if(C)return C.addEventListener(A,R),()=>C.removeEventListener(A,R)},[R]),t.jsx(Ye,{scope:n,orientation:s,dir:d,loop:l,currentTabStopId:h,onItemFocus:f.useCallback(C=>j(C),[j]),onItemShiftTab:f.useCallback(()=>g(!0),[]),onFocusableItemAdd:f.useCallback(()=>J(C=>C+1),[]),onFocusableItemRemove:f.useCallback(()=>J(C=>C-1),[]),children:t.jsx(T.div,{tabIndex:b||Ce===0?-1:0,"data-orientation":s,...m,ref:v,style:{outline:"none",...e.style},onMouseDown:N(e.onMouseDown,()=>{F.current=!0}),onFocus:N(e.onFocus,C=>{const Ne=!F.current;if(C.target===C.currentTarget&&Ne&&!b){const z=new CustomEvent(A,He);if(C.currentTarget.dispatchEvent(z),!z.defaultPrevented){const _=I().filter(w=>w.focusable),we=_.find(w=>w.active),ye=_.find(w=>w.id===h),Re=[we,ye,..._].filter(Boolean).map(w=>w.ref.current);ae(Re,x)}}F.current=!1}),onBlur:N(e.onBlur,()=>g(!1))})})}),se="RovingFocusGroupItem",re=f.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:n,focusable:s=!0,active:l=!1,tabStopId:i,...r}=e,a=X(),u=i||a,c=Qe(se,n),x=c.currentTabStopId===u,m=te(n),{onFocusableItemAdd:p,onFocusableItemRemove:v}=c;return f.useEffect(()=>{if(s)return p(),()=>v()},[s,p,v]),t.jsx(D.ItemSlot,{scope:n,id:u,focusable:s,active:l,children:t.jsx(T.span,{tabIndex:x?0:-1,"data-orientation":c.orientation,...r,ref:o,onMouseDown:N(e.onMouseDown,d=>{s?c.onItemFocus(u):d.preventDefault()}),onFocus:N(e.onFocus,()=>c.onItemFocus(u)),onKeyDown:N(e.onKeyDown,d=>{if(d.key==="Tab"&&d.shiftKey){c.onItemShiftTab();return}if(d.target!==d.currentTarget)return;const h=et(d,c.orientation,c.dir);if(h!==void 0){if(d.metaKey||d.ctrlKey||d.altKey||d.shiftKey)return;d.preventDefault();let b=m().filter(g=>g.focusable).map(g=>g.ref.current);if(h==="last")b.reverse();else if(h==="prev"||h==="next"){h==="prev"&&b.reverse();const g=b.indexOf(d.currentTarget);b=c.loop?tt(b,g+1):b.slice(g+1)}setTimeout(()=>ae(b))}})})})});re.displayName=se;var Xe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Ze(e,o){return o!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function et(e,o,n){const s=Ze(e.key,n);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return Xe[s]}function ae(e,o=!1){const n=document.activeElement;for(const s of e)if(s===n||(s.focus({preventScroll:o}),document.activeElement!==n))return}function tt(e,o){return e.map((n,s)=>e[(o+s)%e.length])}var ot=ne,nt=re,B="Tabs",[st,ht]=Fe(B,[oe]),ce=oe(),[rt,G]=st(B),ie=f.forwardRef((e,o)=>{const{__scopeTabs:n,value:s,onValueChange:l,defaultValue:i,orientation:r="horizontal",dir:a,activationMode:u="automatic",...c}=e,x=ee(a),[m,p]=W({prop:s,onChange:l,defaultProp:i});return t.jsx(rt,{scope:n,baseId:X(),value:m,onValueChange:p,orientation:r,dir:x,activationMode:u,children:t.jsx(T.div,{dir:x,"data-orientation":r,...c,ref:o})})});ie.displayName=B;var le="TabsList",ue=f.forwardRef((e,o)=>{const{__scopeTabs:n,loop:s=!0,...l}=e,i=G(le,n),r=ce(n);return t.jsx(ot,{asChild:!0,...r,orientation:i.orientation,dir:i.dir,loop:s,children:t.jsx(T.div,{role:"tablist","aria-orientation":i.orientation,...l,ref:o})})});ue.displayName=le;var de="TabsTrigger",fe=f.forwardRef((e,o)=>{const{__scopeTabs:n,value:s,disabled:l=!1,...i}=e,r=G(de,n),a=ce(n),u=xe(r.baseId,s),c=ve(r.baseId,s),x=s===r.value;return t.jsx(nt,{asChild:!0,...a,focusable:!l,active:x,children:t.jsx(T.button,{type:"button",role:"tab","aria-selected":x,"aria-controls":c,"data-state":x?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:u,...i,ref:o,onMouseDown:N(e.onMouseDown,m=>{!l&&m.button===0&&m.ctrlKey===!1?r.onValueChange(s):m.preventDefault()}),onKeyDown:N(e.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&r.onValueChange(s)}),onFocus:N(e.onFocus,()=>{const m=r.activationMode!=="manual";!x&&!l&&m&&r.onValueChange(s)})})})});fe.displayName=de;var me="TabsContent",pe=f.forwardRef((e,o)=>{const{__scopeTabs:n,value:s,forceMount:l,children:i,...r}=e,a=G(me,n),u=xe(a.baseId,s),c=ve(a.baseId,s),x=s===a.value,m=f.useRef(x);return f.useEffect(()=>{const p=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(p)},[]),t.jsx(Ee,{present:l||x,children:({present:p})=>t.jsx(T.div,{"data-state":x?"active":"inactive","data-orientation":a.orientation,role:"tabpanel","aria-labelledby":u,hidden:!p,id:c,tabIndex:0,...r,ref:o,style:{...e.style,animationDuration:m.current?"0s":void 0},children:p&&i})})});pe.displayName=me;function xe(e,o){return`${e}-trigger-${o}`}function ve(e,o){return`${e}-content-${o}`}var at=ie,he=ue,be=fe,ge=pe;const ct=at,je=f.forwardRef(({className:e,...o},n)=>t.jsx(he,{ref:n,className:E("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",e),...o}));je.displayName=he.displayName;const k=f.forwardRef(({className:e,...o},n)=>t.jsx(be,{ref:n,className:E("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",e),...o}));k.displayName=be.displayName;const O=f.forwardRef(({className:e,...o},n)=>t.jsx(ge,{ref:n,className:E("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...o}));O.displayName=ge.displayName;function it(e){const{failedJob:o,showDeleteButton:n,onDelete:s,showRetryButton:l,onRetry:i,showFailedAt:r}=e,a=()=>{navigator.clipboard.writeText(o.payload)},u=()=>{navigator.clipboard.writeText(o.exception)};return t.jsxs(t.Fragment,{children:[t.jsx(Z,{children:t.jsxs("div",{className:"flex w-full items-center",children:[t.jsx("div",{className:"flex-1"}),l&&t.jsx(S,{size:"icon",variant:"ghost",className:"text-indigo-800",onClick:c=>{c.stopPropagation(),i&&i(o)},children:t.jsx(Y,{className:"w-4 h-4"})}),n&&t.jsx(S,{size:"icon",variant:"ghost",className:"text-red-800",onClick:c=>{c.stopPropagation(),s&&s(o)},children:t.jsx(Q,{className:"w-4 h-4"})})]})}),t.jsxs("div",{children:[t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{children:["ID: ",o.id]}),t.jsxs("div",{children:[t.jsxs("div",{children:["On ",t.jsx("span",{className:"font-semibold",children:o.queue})," queue"]}),r&&t.jsxs("div",{children:["At ",o.failed_at," (",$e(o.failed_at).fromNow(),")"]})]})]}),t.jsx("hr",{}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"p-4",children:t.jsxs(ct,{defaultValue:"payload",children:[t.jsxs(je,{children:[t.jsx(k,{value:"payload",children:"Payload"}),t.jsx(k,{value:"exception",children:"Exception"})]}),t.jsx(O,{value:"payload",children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute right-0 top-0 p-2 z-30",children:t.jsx(S,{size:"icon",variant:"outline",onClick:a,children:t.jsx(H,{className:"w-4 h-4"})})}),t.jsx("div",{className:"flex-1 relative w-full max-h-[500px] overflow-auto border",children:t.jsx("pre",{className:" left-0 right-0 top-0 bottom-0 p-4 text-wrap",children:JSON.stringify(JSON.parse(o.payload),null,2)})})]})}),t.jsx(O,{value:"exception",children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute right-0 top-0 p-2 z-30",children:t.jsx(S,{size:"icon",variant:"outline",onClick:u,children:t.jsx(H,{className:"w-4 h-4"})})}),t.jsx("div",{className:"flex-1 relative w-full max-h-[500px] overflow-auto border",children:t.jsx("pre",{className:"left-0 right-0 top-0 bottom-0 p-4 text-wrap",children:o.exception})})]})})]})})})]})]})}async function lt(){return(await L(`/api${$}/failed-jobs`,{headers:{Accept:"application/json"}})).json()}async function ut(e){return(await L(`/api${$}/failed-jobs/${e}`,{method:"DELETE",headers:{Accept:"application/json"}})).json()}async function dt(e){return(await L(`/api${$}/failed-jobs/${e}/retry`,{method:"POST",headers:{Accept:"application/json"}})).json()}const bt=Ie("/failed-jobs/")({component:ft});function ft(){var i,r,a,u;const[e,o]=f.useState(null),n=Pe({queryKey:["failed-jobs"],queryFn:lt}),s=q({mutationFn:ut,onSuccess:()=>{n.refetch(),K("Job deleted successfully")}}),l=q({mutationFn:dt,onSuccess:()=>{n.refetch(),K("Job retried successfully")}});return t.jsx("div",{className:"w-full h-full",children:t.jsxs(_e,{direction:"horizontal",children:[t.jsxs(U,{children:[t.jsx(Z,{children:t.jsx("h1",{className:"font-medium flex-1",children:"Failed Jobs"})}),t.jsxs("div",{className:"flex flex-col space-y-2 p-4",children:[n.isLoading&&t.jsx(Ae,{className:"w-full"}),n.isError&&t.jsx(Me,{children:n.error.message}),n.isSuccess&&((r=(i=n.data)==null?void 0:i.data)==null?void 0:r.length)===0&&t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(De,{children:t.jsx("div",{className:"text-lg font-extralight",children:"Congratulations, no failed jobs!"})})}),n.isSuccess&&((u=(a=n.data)==null?void 0:a.data)==null?void 0:u.map(c=>t.jsx(Le,{failedJob:c,className:E((e==null?void 0:e.id)===c.id?"bg-zinc-100":void 0,"border","border-zinc-200","rounded-sm"),onDelete:()=>s.mutate(c.id),onRetry:()=>l.mutate(c.id),showRetryButton:!0,showDeleteButton:!0,showFailedAt:!0,onItemClick:()=>o(c)},c.id)))]})]}),t.jsx(ke,{}),t.jsx(U,{children:e&&t.jsx(it,{failedJob:e,showRetryButton:!0,showFailedAt:!0,showDeleteButton:!0,onRetry:()=>l.mutate(e.id),onDelete:()=>s.mutate(e.id)})})]})})}export{bt as Route};
