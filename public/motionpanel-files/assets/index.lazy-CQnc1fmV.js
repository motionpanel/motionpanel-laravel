import{j as t,r as f,b as y,H as $,c as Re,J as z}from"./app-BKI5hTUl.js";import{B as Ie,a as S,R as q,T as Y,b as M,S as K,i as Q,u as Se,P as T,c as N,j as W,f as Te,g as Fe,C as V,l as Ee,m as H,n as _e,o as U,E as Pe,p as Ae}from"./index-K2X3vo1_.js";import{c as E,g as Me,P as X,h as De}from"./page-header-CUguciq2.js";function ke(e){const{failedJob:o,onDelete:n,onRetry:s,showFailedAt:u,showRetryButton:l,showDeleteButton:r,description:a,className:i,onItemClick:c}=e;return t.jsx("div",{className:E("rounded","dark:border","dark:border-slate-800","hover:bg-zinc-100","transition-colors","p-4","cursor-pointer",i),onClick:()=>c&&c(o),children:t.jsxs("div",{className:"flex",children:[t.jsxs("div",{className:"flex-col flex-1",children:[t.jsx(Ie,{className:"font-semibold mb-2",children:o.queue}),t.jsx("div",{className:"flex",children:t.jsxs("div",{className:"font-semibold",children:["ID: ",o.id]})}),t.jsxs("div",{className:"flex-col",children:[u&&t.jsxs("div",{className:"text-gray-500",children:["Failed ",Me(o.failed_at)]}),a&&t.jsx("em",{className:"dark:text-slate-500",children:a})]})]}),t.jsxs("div",{className:"flex space-x-2",children:[l&&t.jsx(S,{size:"icon",variant:"ghost",className:"text-indigo-800",onClick:p=>{p.stopPropagation(),s&&s(o)},children:t.jsx(q,{className:"w-4 h-4"})}),r&&t.jsx(S,{size:"icon",variant:"ghost",className:"text-red-800",onClick:p=>{p.stopPropagation(),n&&n(o)},children:t.jsx(Y,{className:"w-4 h-4"})})]})]})})}function Oe(e,o=[]){let n=[];function s(l,r){const a=f.createContext(r),i=n.length;n=[...n,r];function c(m){const{scope:x,children:v,...d}=m,h=(x==null?void 0:x[e][i])||a,j=f.useMemo(()=>d,Object.values(d));return t.jsx(h.Provider,{value:j,children:v})}function p(m,x){const v=(x==null?void 0:x[e][i])||a,d=f.useContext(v);if(d)return d;if(r!==void 0)return r;throw new Error(`\`${m}\` must be used within \`${l}\``)}return c.displayName=l+"Provider",[c,p]}const u=()=>{const l=n.map(r=>f.createContext(r));return function(a){const i=(a==null?void 0:a[e])||l;return f.useMemo(()=>({[`__scope${e}`]:{...a,[e]:i}}),[a,i])}};return u.scopeName=e,[s,$e(u,...o)]}function $e(...e){const o=e[0];if(e.length===1)return o;const n=()=>{const s=e.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(l){const r=s.reduce((a,{useScope:i,scopeName:c})=>{const m=i(l)[`__scope${c}`];return{...a,...m}},{});return f.useMemo(()=>({[`__scope${o.scopeName}`]:r}),[r])}};return n.scopeName=o.scopeName,n}function Le(e){const o=e+"CollectionProvider",[n,s]=Oe(o),[u,l]=n(o,{collectionRef:{current:null},itemMap:new Map}),r=v=>{const{scope:d,children:h}=v,j=y.useRef(null),b=y.useRef(new Map).current;return t.jsx(u,{scope:d,itemMap:b,collectionRef:j,children:h})};r.displayName=o;const a=e+"CollectionSlot",i=y.forwardRef((v,d)=>{const{scope:h,children:j}=v,b=l(a,h),g=M(d,b.collectionRef);return t.jsx(K,{ref:g,children:j})});i.displayName=a;const c=e+"CollectionItemSlot",p="data-radix-collection-item",m=y.forwardRef((v,d)=>{const{scope:h,children:j,...b}=v,g=y.useRef(null),R=M(d,g),I=l(c,h);return y.useEffect(()=>(I.itemMap.set(g,{ref:g,...b}),()=>void I.itemMap.delete(g))),t.jsx(K,{[p]:"",ref:R,children:j})});m.displayName=c;function x(v){const d=l(e+"CollectionConsumer",v);return y.useCallback(()=>{const j=d.collectionRef.current;if(!j)return[];const b=Array.from(j.querySelectorAll(`[${p}]`));return Array.from(d.itemMap.values()).sort((I,F)=>b.indexOf(I.ref.current)-b.indexOf(F.ref.current))},[d.collectionRef,d.itemMap])}return[{Provider:r,Slot:i,ItemSlot:m},x,s]}function Be(e,o=[]){let n=[];function s(l,r){const a=f.createContext(r),i=n.length;n=[...n,r];function c(m){const{scope:x,children:v,...d}=m,h=(x==null?void 0:x[e][i])||a,j=f.useMemo(()=>d,Object.values(d));return t.jsx(h.Provider,{value:j,children:v})}function p(m,x){const v=(x==null?void 0:x[e][i])||a,d=f.useContext(v);if(d)return d;if(r!==void 0)return r;throw new Error(`\`${m}\` must be used within \`${l}\``)}return c.displayName=l+"Provider",[c,p]}const u=()=>{const l=n.map(r=>f.createContext(r));return function(a){const i=(a==null?void 0:a[e])||l;return f.useMemo(()=>({[`__scope${e}`]:{...a,[e]:i}}),[a,i])}};return u.scopeName=e,[s,Ge(u,...o)]}function Ge(...e){const o=e[0];if(e.length===1)return o;const n=()=>{const s=e.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(l){const r=s.reduce((a,{useScope:i,scopeName:c})=>{const m=i(l)[`__scope${c}`];return{...a,...m}},{});return f.useMemo(()=>({[`__scope${o.scopeName}`]:r}),[r])}};return n.scopeName=o.scopeName,n}var Je=f.createContext(void 0);function Z(e){const o=f.useContext(Je);return e||o||"ltr"}var A="rovingFocusGroup.onEntryFocus",ze={bubbles:!1,cancelable:!0},_="RovingFocusGroup",[D,ee,Ke]=Le(_),[Ve,te]=Be(_,[Ke]),[He,Ue]=Ve(_),oe=f.forwardRef((e,o)=>t.jsx(D.Provider,{scope:e.__scopeRovingFocusGroup,children:t.jsx(D.Slot,{scope:e.__scopeRovingFocusGroup,children:t.jsx(qe,{...e,ref:o})})}));oe.displayName=_;var qe=f.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:n,orientation:s,loop:u=!1,dir:l,currentTabStopId:r,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:i,onEntryFocus:c,preventScrollOnEntryFocus:p=!1,...m}=e,x=f.useRef(null),v=M(o,x),d=Z(l),[h=null,j]=Q({prop:r,defaultProp:a,onChange:i}),[b,g]=f.useState(!1),R=Se(c),I=ee(n),F=f.useRef(!1),[je,G]=f.useState(0);return f.useEffect(()=>{const C=x.current;if(C)return C.addEventListener(A,R),()=>C.removeEventListener(A,R)},[R]),t.jsx(He,{scope:n,orientation:s,dir:d,loop:u,currentTabStopId:h,onItemFocus:f.useCallback(C=>j(C),[j]),onItemShiftTab:f.useCallback(()=>g(!0),[]),onFocusableItemAdd:f.useCallback(()=>G(C=>C+1),[]),onFocusableItemRemove:f.useCallback(()=>G(C=>C-1),[]),children:t.jsx(T.div,{tabIndex:b||je===0?-1:0,"data-orientation":s,...m,ref:v,style:{outline:"none",...e.style},onMouseDown:N(e.onMouseDown,()=>{F.current=!0}),onFocus:N(e.onFocus,C=>{const Ce=!F.current;if(C.target===C.currentTarget&&Ce&&!b){const J=new CustomEvent(A,ze);if(C.currentTarget.dispatchEvent(J),!J.defaultPrevented){const P=I().filter(w=>w.focusable),Ne=P.find(w=>w.active),we=P.find(w=>w.id===h),ye=[Ne,we,...P].filter(Boolean).map(w=>w.ref.current);re(ye,p)}}F.current=!1}),onBlur:N(e.onBlur,()=>g(!1))})})}),ne="RovingFocusGroupItem",se=f.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:n,focusable:s=!0,active:u=!1,tabStopId:l,...r}=e,a=W(),i=l||a,c=Ue(ne,n),p=c.currentTabStopId===i,m=ee(n),{onFocusableItemAdd:x,onFocusableItemRemove:v}=c;return f.useEffect(()=>{if(s)return x(),()=>v()},[s,x,v]),t.jsx(D.ItemSlot,{scope:n,id:i,focusable:s,active:u,children:t.jsx(T.span,{tabIndex:p?0:-1,"data-orientation":c.orientation,...r,ref:o,onMouseDown:N(e.onMouseDown,d=>{s?c.onItemFocus(i):d.preventDefault()}),onFocus:N(e.onFocus,()=>c.onItemFocus(i)),onKeyDown:N(e.onKeyDown,d=>{if(d.key==="Tab"&&d.shiftKey){c.onItemShiftTab();return}if(d.target!==d.currentTarget)return;const h=We(d,c.orientation,c.dir);if(h!==void 0){if(d.metaKey||d.ctrlKey||d.altKey||d.shiftKey)return;d.preventDefault();let b=m().filter(g=>g.focusable).map(g=>g.ref.current);if(h==="last")b.reverse();else if(h==="prev"||h==="next"){h==="prev"&&b.reverse();const g=b.indexOf(d.currentTarget);b=c.loop?Xe(b,g+1):b.slice(g+1)}setTimeout(()=>re(b))}})})})});se.displayName=ne;var Ye={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Qe(e,o){return o!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function We(e,o,n){const s=Qe(e.key,n);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return Ye[s]}function re(e,o=!1){const n=document.activeElement;for(const s of e)if(s===n||(s.focus({preventScroll:o}),document.activeElement!==n))return}function Xe(e,o){return e.map((n,s)=>e[(o+s)%e.length])}var Ze=oe,et=se,L="Tabs",[tt,xt]=Te(L,[te]),ae=te(),[ot,B]=tt(L),ie=f.forwardRef((e,o)=>{const{__scopeTabs:n,value:s,onValueChange:u,defaultValue:l,orientation:r="horizontal",dir:a,activationMode:i="automatic",...c}=e,p=Z(a),[m,x]=Q({prop:s,onChange:u,defaultProp:l});return t.jsx(ot,{scope:n,baseId:W(),value:m,onValueChange:x,orientation:r,dir:p,activationMode:i,children:t.jsx(T.div,{dir:p,"data-orientation":r,...c,ref:o})})});ie.displayName=L;var ce="TabsList",le=f.forwardRef((e,o)=>{const{__scopeTabs:n,loop:s=!0,...u}=e,l=B(ce,n),r=ae(n);return t.jsx(Ze,{asChild:!0,...r,orientation:l.orientation,dir:l.dir,loop:s,children:t.jsx(T.div,{role:"tablist","aria-orientation":l.orientation,...u,ref:o})})});le.displayName=ce;var ue="TabsTrigger",de=f.forwardRef((e,o)=>{const{__scopeTabs:n,value:s,disabled:u=!1,...l}=e,r=B(ue,n),a=ae(n),i=xe(r.baseId,s),c=pe(r.baseId,s),p=s===r.value;return t.jsx(et,{asChild:!0,...a,focusable:!u,active:p,children:t.jsx(T.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":c,"data-state":p?"active":"inactive","data-disabled":u?"":void 0,disabled:u,id:i,...l,ref:o,onMouseDown:N(e.onMouseDown,m=>{!u&&m.button===0&&m.ctrlKey===!1?r.onValueChange(s):m.preventDefault()}),onKeyDown:N(e.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&r.onValueChange(s)}),onFocus:N(e.onFocus,()=>{const m=r.activationMode!=="manual";!p&&!u&&m&&r.onValueChange(s)})})})});de.displayName=ue;var fe="TabsContent",me=f.forwardRef((e,o)=>{const{__scopeTabs:n,value:s,forceMount:u,children:l,...r}=e,a=B(fe,n),i=xe(a.baseId,s),c=pe(a.baseId,s),p=s===a.value,m=f.useRef(p);return f.useEffect(()=>{const x=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(x)},[]),t.jsx(Fe,{present:u||p,children:({present:x})=>t.jsx(T.div,{"data-state":p?"active":"inactive","data-orientation":a.orientation,role:"tabpanel","aria-labelledby":i,hidden:!x,id:c,tabIndex:0,...r,ref:o,style:{...e.style,animationDuration:m.current?"0s":void 0},children:x&&l})})});me.displayName=fe;function xe(e,o){return`${e}-trigger-${o}`}function pe(e,o){return`${e}-content-${o}`}var nt=ie,ve=le,he=de,be=me;const st=nt,ge=f.forwardRef(({className:e,...o},n)=>t.jsx(ve,{ref:n,className:E("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",e),...o}));ge.displayName=ve.displayName;const k=f.forwardRef(({className:e,...o},n)=>t.jsx(he,{ref:n,className:E("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",e),...o}));k.displayName=he.displayName;const O=f.forwardRef(({className:e,...o},n)=>t.jsx(be,{ref:n,className:E("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...o}));O.displayName=be.displayName;function rt(e){const{failedJob:o,showDeleteButton:n,onDelete:s,showRetryButton:u,onRetry:l,showFailedAt:r}=e,a=()=>{navigator.clipboard.writeText(JSON.stringify(o,null,2))};return t.jsxs(t.Fragment,{children:[t.jsx(X,{children:t.jsxs("div",{className:"flex w-full items-center",children:[t.jsx("div",{className:"flex-1"}),u&&t.jsx(S,{size:"icon",variant:"ghost",className:"text-indigo-800",onClick:i=>{i.stopPropagation(),l&&l(o)},children:t.jsx(q,{className:"w-4 h-4"})}),n&&t.jsx(S,{size:"icon",variant:"ghost",className:"text-red-800",onClick:i=>{i.stopPropagation(),s&&s(o)},children:t.jsx(Y,{className:"w-4 h-4"})})]})}),t.jsxs("div",{children:[t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{children:["ID: ",o.id]}),t.jsxs("div",{children:[t.jsxs("div",{children:["On ",t.jsx("span",{className:"font-semibold",children:o.queue})," queue"]}),r&&t.jsxs("div",{children:["At ",o.failed_at," (",De(o.failed_at).fromNow(),")"]})]})]}),t.jsx("hr",{}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"p-4",children:t.jsxs(st,{defaultValue:"payload",children:[t.jsxs(ge,{children:[t.jsx(k,{value:"payload",children:"Payload"}),t.jsx(k,{value:"exception",children:"Exception"})]}),t.jsx(O,{value:"payload",children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute right-0 top-0 p-2 z-30",children:t.jsx(S,{size:"icon",variant:"outline",onClick:a,children:t.jsx(V,{className:"w-4 h-4"})})}),t.jsx("div",{className:"flex-1 relative w-full max-h-[500px] overflow-auto border",children:t.jsx("pre",{className:" left-0 right-0 top-0 bottom-0 p-4 text-wrap",children:JSON.stringify(JSON.parse(o.payload),null,2)})})]})}),t.jsx(O,{value:"exception",children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute right-0 top-0 p-2 z-30",children:t.jsx(S,{size:"icon",variant:"outline",onClick:a,children:t.jsx(V,{className:"w-4 h-4"})})}),t.jsx("div",{className:"flex-1 relative w-full max-h-[500px] overflow-auto border",children:t.jsx("pre",{className:"left-0 right-0 top-0 bottom-0 p-4 text-wrap",children:o.exception})})]})})]})})})]})]})}async function at(){return(await fetch(`/api${$}/failed-jobs`)).json()}async function it(e){return(await fetch(`/api${$}/failed-jobs/${e}`,{method:"DELETE"})).json()}async function ct(e){return(await fetch(`/api${$}/failed-jobs/${e}/retry`,{method:"POST"})).json()}const pt=Re("/failed-jobs/")({component:lt});function lt(){var l,r,a,i;const[e,o]=f.useState(null),n=Ee({queryKey:["failed-jobs"],queryFn:at}),s=H({mutationFn:it,onSuccess:()=>{n.refetch(),z("Job deleted successfully")}}),u=H({mutationFn:ct,onSuccess:()=>{n.refetch(),z("Job retried successfully")}});return t.jsx("div",{className:"w-full h-full",children:t.jsxs(_e,{direction:"horizontal",children:[t.jsxs(U,{children:[t.jsx(X,{children:t.jsx("h1",{className:"font-medium flex-1",children:"Failed Jobs"})}),t.jsxs("div",{className:"flex flex-col space-y-2 p-4",children:[n.isLoading&&t.jsx("div",{children:"Loading..."}),n.isError&&t.jsxs("div",{children:["Error: ",n.error.message]}),n.isSuccess&&((r=(l=n.data)==null?void 0:l.data)==null?void 0:r.length)===0&&t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(Pe,{children:t.jsx("div",{className:"text-lg font-extralight",children:"Congratulations, no failed jobs!"})})}),n.isSuccess&&((i=(a=n.data)==null?void 0:a.data)==null?void 0:i.map(c=>t.jsx(ke,{failedJob:c,className:E((e==null?void 0:e.id)===c.id?"bg-zinc-100":void 0,"border","border-zinc-200","rounded-sm"),onDelete:()=>s.mutate(c.id),onRetry:()=>u.mutate(c.id),showRetryButton:!0,showDeleteButton:!0,showFailedAt:!0,onItemClick:()=>o(c)},c.id)))]})]}),t.jsx(Ae,{}),t.jsx(U,{children:e&&t.jsx(rt,{failedJob:e,showRetryButton:!0,showFailedAt:!0,showDeleteButton:!0,onRetry:()=>u.mutate(e.id),onDelete:()=>s.mutate(e.id)})})]})})}export{pt as Route};
